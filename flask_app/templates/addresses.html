{% extends "layout.html" %}

{% block title%}Addresses{% endblock %}

{% block content %}

<!-- Update Address Modal -->
<div class="modal" tabindex="-1" id="edit">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <h4 id="modal-name" class="mt-0 mb-3"></h4>
        <form id="update-form" action="/update-address" method="POST">
          <div class="form-options">
            <label for="address1">Address Line 1: </label>
            <input type="text" name="address1" id="address1" required autofocus />
            <br>
            <label for="address2">Address Line 2: </label>
            <input type="text" name="address2" id="address2" autofocus />
            <br>
            <label for="city">City: </label>
            <input type="text" name="city" id="city" required autofocus />
            <br>
            <label for="state">State: </label>
            <input type="text" name="state" id="state" required autofocus />
            <br>
            <label for="country">Country: </label>
            <input type="text" name="country" id="country" required autofocus />
            <br>
            <label for="zip">Zip Code: </label>
            <input type="text" name="zip" id="zip" required autofocus />
            <input type="number" name="address-id" id="address-id" required hidden>
          </div>
          <button id="sub-button" type="submit" class="btn btn-dark">Update</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Delete Address Modal -->
<div class="modal" tabindex="-1" id="delete">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <h4 id="modal-name" class="mt-0 mb-3"></h4>
        <form id="delete-form" action="/delete-address" method="POST">
          <div class="form-options">
            <h4>This action is permanent</h4>
            <input type="number" name="address-id2" id="address-id2" required hidden>
          </div>
          <button id="sub-button" type="submit" class="btn btn-dark">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>

<section class="query-header container">
    {% if addresses|length > 0 %}
      <div class="query-info">
        <button class="btn, btn-dark" onclick="createAddress()">New User</button>
        <p><b>Total number of users: </b>{{ addresses|length }}</p>
      </div>
      <div class="table-responsive">
        <table class="table table-dark table-striped table-hover">
          <thead class="table">
            <tr>
              <th>#</th>
              <th>Address</th>
              <th></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for i in range(addresses|length) %}
              <tr>
                  <!-- # -->
                  <td>{{ i+1 }}</td>
                  <!-- Address -->
                  <td>{{ addresses[i][1] }} {{addresses[i][2] or ""}}, {{ addresses[i][3] }}, {{ addresses[i][4] }}, {{ addresses[i][5] }}, {{ addresses[i][6] }}</td>
                  <!-- Edit -->
                  <td>
                    <button><i class="bi bi-pencil-fill" onclick="editAddress('{{addresses[i][0]}}', '{{ addresses[i][1] }}','{{addresses[i][2] or ""}}', '{{ addresses[i][3] }}', '{{ addresses[i][4] }}', '{{ addresses[i][5] }}', '{{ addresses[i][6] }}')"></i></button>
                  </td>
                  <!-- Delete -->
                  <td>
                    <button><i class="bi bi-trash" onclick="deleteAddress('{{addresses[i][0]}}')"></i></button>
                  </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <h3>There are no active addresses</h3>
    {% endif %}
  </section>

  <script>
    function editAddress(_id, _al1, _al2, _city, _state, _country, _zipcode){
      document.querySelector('#address-id').value = _id;
      document.querySelector('#address1').value = _al1;
      document.querySelector('#address2').value = _al2;
      document.querySelector('#city').value = _city;
      document.querySelector('#state').value = _state;
      document.querySelector('#country').value = _country;
      document.querySelector('#zip').value = _zipcode;
      $("#edit").modal('show');
    }

    function deleteAddress(_id){
      console.log(_id);
      document.querySelector('#address-id2').value = _id;
      $('#delete').modal('show');
    }
  </script>

{% endblock %}